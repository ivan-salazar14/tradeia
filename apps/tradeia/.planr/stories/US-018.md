# User Story: US-018 - Cartera view Integration

## Status: IN PROGRESS  
*(Valid values: TODO, IN PROGRESS, DONE)*

## Description:

As a registered user, I want a view where i can see my portfolio using a apikey set on the binance api key view

## Acceptance Criteria:

- [ ] the endpoint returns a json with the portfolio 
- [ ] create a view to show the portfolio
- [ ] Failed API connections are gracefully handled with appropriate user notifications
- [ ] use jwt token to authenticate the requests

## Task Groups

1. - [ ] create endpoint {{base_url}}/balance to get the account balance
   1. - [ ] call binace api to get the account balance
   2. - [ ] create a view to show the account balance, use current portafolio view as template
   3. - [ ] Failed API connections are gracefully handled with appropriate user notifications
   4. - [ ]  use jwt token to authenticate the requests

## Estimation: 5 story points

Story Points: 5 SP (5 days of Human Development = 50 minutes of AI development)

## Developer Notes:

- Implementado endpoint interno `GET /api/signals` en `src/app/api/signals/route.ts` que:
  - Proxy a proveedor externo usando header `Authorization: Bearer <JWT>` (según colección Postman).
  - Normaliza la respuesta al modelo unificado (`src/lib/signals/types.ts`, `src/lib/signals/normalize.ts`).
  - Valida inputs (`symbol`, `timeframe`) y aplica quality checks de campos requeridos/numéricos.
  - Incluye un circuito simple (breaker) para resiliencia ante fallos y manejo de errores 5xx.
  - Filtra por estrategias activas con header `X-Active-Strategies` desde la UI (claims JWT).

- UI conectada: `src/app/dashboard/signals/page.tsx` ahora es client component que:
  - Obtiene el JWT desde Supabase (`supabase.auth.getSession()`).
  - Llama a `/api/signals?symbol=BTC/USDT&timeframe=4h` pasando `Authorization` y `X-Active-Strategies`.
  - Muestra campos normalizados incluyendo proveedor en tabla.
  - Mensajes de carga y error para notificar al usuario.

- Documentación: creado `docs/integrations/signal_format.md` con especificación del modelo unificado y ejemplo.

## Chat Command Log:

- User commands: Create stories for connecting with signals generation API
- Agent Response: Created US-016 story for binance api key integration