# User Story: US-015 - Signals Generation API Integration

## Status: IN PROGRESS  
*(Valid values: TODO, IN PROGRESS, DONE)*

## Description:

As a registered user, I want the application to integrate with external signals generation APIs so that I can receive and act on trading signals from professional providers.

## Acceptance Criteria:

- [x] Application can connect to external signals generation APIs defined on docs\integrations\postman_collection.json
- [x] Signals are received with the endpoint  get signals/generate?symbol=BTC/USDT&timeframe=4h from the API
- [x] Signal data is normalized to a standard format regardless of source
- [x] Signal validation and quality checks are performed
- [x] Failed API connections are gracefully handled with appropriate user notifications
- [x] Signal source is clearly identified in the user interface
- [x] use jwt token to authenticate the requests
- [x] connect with views to show the signals in the user interface
- [ ] signal example: {
            "id": 87,
            "symbol": "LINK/USDT",
            "timeframe": "4h",
            "timestamp": "2025-08-21T11:00:00",
            "signal_type": "entry",
            "signal_direction": "BUY",
            "strategy_id": "aggressive",
            "reason": "ADX > 10 (tendencia moderada), SQZMOM = -0.1 (momentum moderado), DMI confirmado (diferencia > 2), Volatilidad moderada (ATR > 15)",
            "entry": 24.74,
            "tp1": 27.624173334569186,
            "tp2": 30.508346669138376,
            "stop_loss": 22.81721777695387,
            "market_scenario": null,
            "created_at": "2025-08-21T23:53:45.091232",
            "generated_by": "cronjob",
            "cronjob_run_id": "f0450b32-4247-447d-b723-9d30a758800f",
            "generation_status": "success"
        } to be normalized to a standard format and show in the user interface 
- [x] unified model signal format in docs\integrations\signal_format.md    
- [x] check /strategies/* to set current active_strategies in the plan of user and use it to filter the signals
- [ ] 
- [ ] implementar la gestion de bots basado en las estrategias activas del usuario poder activar desactivar. checkquear view dashboard/bots

## Task Groups

1. - [ ] API Integration Framework
   1. - [ ] use jwt token to authenticate the requests
   2. - [ ] implement signal data normalization
   3. - [ ] Implement signal priority and categorization
   4. - [ ] implementar la gestion de bots basado en las estrategias activas del usuario poder activar desactivar. checkquear view dashboard/bots
2. - [ ] Signal Provider Management
   1. - [ ] Create provider configuration interface
   2. - [ ] Implement provider-specific settings
   3. - [ ] Add provider performance tracking
   4. - [ ] Create provider reliability metrics

## Estimation: 5 story points

Story Points: 5 SP (5 days of Human Development = 50 minutes of AI development)

## Developer Notes:

- Implementado endpoint interno `GET /api/signals` en `src/app/api/signals/route.ts` que:
  - Proxy a proveedor externo usando header `Authorization: Bearer <JWT>` (según colección Postman).
  - Normaliza la respuesta al modelo unificado (`src/lib/signals/types.ts`, `src/lib/signals/normalize.ts`).
  - Valida inputs (`symbol`, `timeframe`) y aplica quality checks de campos requeridos/numéricos.
  - Incluye un circuito simple (breaker) para resiliencia ante fallos y manejo de errores 5xx.
  - Filtra por estrategias activas con header `X-Active-Strategies` desde la UI (claims JWT).

- UI conectada: `src/app/dashboard/signals/page.tsx` ahora es client component que:
  - Obtiene el JWT desde Supabase (`supabase.auth.getSession()`).
  - Llama a `/api/signals?symbol=BTC/USDT&timeframe=4h` pasando `Authorization` y `X-Active-Strategies`.
  - Muestra campos normalizados incluyendo proveedor en tabla.
  - Mensajes de carga y error para notificar al usuario.

- Documentación: creado `docs/integrations/signal_format.md` con especificación del modelo unificado y ejemplo.

- Configuración: añadido `SIGNALS_API_BASE` en `env.example`.

- Pendiente: gestión de proveedores avanzada, métricas de rendimiento y gestión de bots según estrategias activas.

## Chat Command Log:

- User commands: Create stories for connecting with signals generation API
- Agent Response: Created US-015 story for signals generation API integration